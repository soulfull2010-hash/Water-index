<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Water Health Index â€” Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;500;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body { background: linear-gradient(135deg, #43cea2 0, #185a9d 100%); font-family: Poppins,sans-serif; margin:0; color:#174357; min-height:100vh;}
    header { background: #156581; box-shadow: 0 2px 14px #0002; position:sticky;top:0;z-index:1000; }
    .navbar { display:flex;align-items:center;max-width:1200px;margin:auto;padding:0 20px;}
    .brand {font-weight:800;color:#f2f7fa;font-size:1.5rem;display:flex;align-items:center; letter-spacing:1px;}
    .logo { font-size:2.2rem; margin-right:9px; user-select:none; animation:wave 2.2s infinite; transform-origin: 70% 70%;}
    @keyframes wave {0%,100%{transform:rotate(0)} 25%{transform:rotate(12deg)} 50%{transform:rotate(-8deg)} 75%{transform:rotate(6deg)}}
    nav {margin-left:auto;}
    nav a {background:none;border:none;outline:none;font-weight:700;color:#f2f7fa;font-size:1.1rem;padding:12px 23px 11px 23px;border-radius:11px;text-decoration:none;transition:background .21s;}
    nav a.active, nav a:hover {background:#43cea2;color:#173247;}
    main {max-width:1100px;margin:24px auto;min-height:79vh;padding:0 12px;}
    h1 {color:#18bcce;margin:40px 0 18px;font-size:2.1rem;font-weight:900;}
    #bigMap {width:100%;height:500px;max-width:1100px;border-radius:1.7em;box-shadow:0 13px 38px #43ceaa28;}
    .map-legend {margin-top:10px;color:#267c92;font-size:1.05rem;}
    @media (max-width:700px) {#bigMap{height:300px;}}
  </style>
</head>
<body>
<header>
  <div class="navbar">
    <span class="brand"><span class="logo">ðŸŒŠ</span> Water Health Index</span>
    <nav>
      <a href="index.html">Home</a>
      <a href="map.html" class="active">Map</a>
    </nav>
  </div>
</header>
<main>
  <h1>World Water Health Map</h1>
  <div id="bigMap"></div>
  <div class="map-legend">Tap a marker for details. Green = Good &bull; Yellow = Moderate &bull; Red = Poor</div>
</main>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
var map = L.map('bigMap',{center:[20,0],zoom:2});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
// Add some global demo points (major rivers)
let samples=[
  {lat:28.61,lng:77.22,idx:91,place:'Yamuna, India',ph:7.2,temp:24,turb:'low'},
  {lat:40.71,lng:-74,idx:80,place:'Hudson, USA',ph:6.5,temp:26,turb:'medium'},
  {lat:-33.87,lng:151.21,idx:90,place:'Sydney Harbour',ph:8.1,temp:22,turb:'low'},
  {lat:51.5,lng:-0.1,idx:75,place:'Thames, UK',ph:7.6,temp:15,turb:'medium'}
];
// Load user/local readings (from prior page) if (saved in localStorage)
try {
  var userPts = JSON.parse(localStorage.getItem('wh_readings')||'[]');
  for(let u of userPts){
    samples.push({
      lat:u.lat||u.loc?.lat, lng:u.lng||u.loc?.lng,
      idx:u.index||u.idx, place:u.place||u.loc?.displayName||"Your Reading",
      ph:u.ph, temp:u.temp, turb:u.turb, date:u.ts?new Date(u.ts).toLocaleString():''
    });
  }
} catch{}
function colorByIndex(idx){
  if(idx>=80)return'#2e7d32';
  if(idx>=50)return'#f9a825';
  return '#c62828';
}
for(let site of samples){
  let marker=L.circleMarker([site.lat,site.lng],{
    radius:11,fillColor:colorByIndex(site.idx),fillOpacity:0.84,color:'#0093E9',weight:2
  }).addTo(map);
  marker.bindPopup(
    `<b>${site.place||'Sample'}</b><br>Index: ${site.idx||'--'}<br>pH: ${site.ph||'--'} &bull; Temp: ${site.temp||'--'} &bull; Turbidity: ${site.turb||'--'}${site.date?`<br>${site.date}`:''}`
  );
}
</script>
</body>
</html>
